# aibw Feature Suggestions

*Generated by Claude Code after Phase 2 implementation (2026-02-08)*

## Security Hardening

### Credential zeroization in handler
The `field_value` string in `handle_bw_get` lives in memory after being sent over the socket. Using `Zeroizing<String>` for the extracted field value (and the `item_json`) would limit exposure window. Currently only the session key is zeroized.

### Scrub queue credential storage
The plaintext credential in `bw_scrub_queue` persists in SQLite until scrubbed. A time-limited retention policy (auto-delete after N hours even if scrub fails) would bound worst-case exposure.

### BW request timeout expiry
The timeout expiry task handles sudo requests and temp rules, but not `bw_requests`. Stale pending BW requests should also be expired.

## UX Improvements

### Vault unlock via Telegram inline flow
Currently if the vault is locked, the request is immediately denied. The plan mentions a web UI (Phase 3) for password entry, but a simpler intermediate step could be a Telegram notification saying "vault locked, unlock needed" with a link to the dashboard â€” even before the full web UI is built.

### `aibw unlock` command
The CLI has `get`, `lock`, `status` but no `unlock`. Even if the web UI is the primary unlock mechanism, a CLI unlock that reads the master password from stdin (piped, never echoed) could be useful for bootstrapping.

### Retry on vault locked
When `handle_bw_get` gets "vault is locked", it could hold the connection open and wait for an unlock event (via a broadcast channel) rather than immediately failing. This would let the human unlock the vault and have the pending request automatically proceed.

## Operational

### Scrubber implementation
The scrub queue scheduling is in place but the actual scrubber (Phase 3) that reads `bw_scrub_queue`, finds credentials in `.jsonl` files, and replaces them hasn't been built yet. The multi-encoding scrub (raw + JSON-escaped + URL-encoded per L5) will need careful implementation.

### Rate limit refinement
BW rate limits are separate from sudo rate limits (good), but the BW rate limit uses `check_bw_rate_limit` which counts all requests including denied ones. A flood of invalid requests could lock out legitimate ones. Consider only counting requests that reach the notification stage.

### Audit log consolidation
BW events use both `audit_log` (via `insert_bw_request`) and `bw_session_events` tables. A unified query view or a simple `aibw audit` command would help with incident review.

## Testing Gaps

### No integration tests for BW socket handlers
The existing socket tests use mock backends but none test the BW flow (`handle_bw_get` with a mock `BwSessionManager`). Adding tests for:
- Vault locked denial
- Rate limit denial
- Name-match auto-confirm
- Name-mismatch confirmation flow

### No test for `discover_session_files`
Simple unit test with a temp directory containing `.jsonl` and non-`.jsonl` files.

## Recommended Next Steps

1. **Web UI** (Phase 3 from the plan)
2. **Scrubber implementation**
3. **BW handler integration tests**
